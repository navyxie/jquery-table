var NAVY=NAVY||{},console=console||{log:function(){}};NAVY.Table=function(e,t,a,s){var n={sortable:[],ths:[],skip:{},changeHanlder:function(e){console.log(e)},footHtml:""};this.docs=a.length?a:[],this.sourceData=t.length?t:[{}],this.sourceDataKeys=this.getKey(this.sourceData[0]),this.jqObj=$(e),$.extend(n,s),this.options=n,this.init()},NAVY.Table.prototype={init:function(){return this.makeTableHtml(),this.initEvent(),this},initEvent:function(){var e=this.jqObj,t=this,a=e.find(".kalengoTable"),s=a.find(".kalengoTbody"),n=a.find("th"),i=a.find(".kalengoTableTr"),o=i.length;return e.on("click",".sortAble",function(){var e=$(this);if(e.hasClass("sortAble")){for(var a=n.index(e),r=0,l=e.hasClass("desc");o>r;r++)i[r].compareValue=$(i[r]).find("td").eq(a).text();i.sort(function(e,t){return l?t.compareValue-e.compareValue:e.compareValue-t.compareValue}),i=t.resetEvenAndOdd(i),s.append(i),e.hasClass("desc")?e.removeClass("desc").addClass("asc"):e.removeClass("asc").addClass("desc")}}).on("blur",".contentContainer",function(){var e=$(this);return e.hasClass("contentContainer")&&(e.removeAttr("contentEditable"),t.onChangeHanlder(e)),!1}).on("dblclick",".contentContainer",function(){var e=$(this);return e.hasClass("contentContainer")&&e.attr("contentEditable",!0),!1}),this},resetEvenAndOdd:function(e){for(var t=0,a=e.length;a>t;t++){var s=$(e[t]);0===(t+1)%2?s.hasClass("odd")&&s.removeClass("odd").addClass("even"):s.hasClass("even")&&s.removeClass("even").addClass("odd")}return e},makeTableHtml:function(){var e=this.docs,t=$.makeArray(e),a=[],s=this.options,n=s.sortable,i=s.skip,o=n.length,r=[];a.push('<table class="kalengoTable">'),e=$.isArray(e)?e:$.isArray(t)?t:[];var l,d=0,c=e.length,h=e[0];for(var u in h)!i[u]&&r.push(u);for(l=r.length,$.extend(r,s.ths),a.push('<thead class="kalengoThead">'),d=0;l>d;d++){for(var m="",p=0;o>p;p++)if(n[p]===d){m="sortAble";break}a.push('<th class="kalengoTableTh kalengoTableTh'+d+" "+m+'"><div class="thContainer">'+r[d]+'</div><div class="arrowContainer upArrow hidden">↑</div><div class="arrowContainer downArrow hidden">↓</div></th>')}for(a.push('</thead><tbody class="kalengoTbody">'),d=0;c>d;d++){h=e[d];var g=0;if($.isPlainObject(h)&&!$.isEmptyObject(h)){var f="odd";0===(d+1)%2&&(f="even"),a.push('<tr class="kalengoTableTr '+f+'">');for(var v in h)a.push('<td td-class="'+v+'" class="'+(i[v]||"")+" kalengoTableTd "+v+" kalengoTableTd"+g++ +'"><div class="contentContainer">'+h[v]+"</div></td>");a.push("</tr>")}}var b=s.footHtml?'<tfoot class="kalengoTableFoot"><tr><th colspan="'+l+'"><p class="footContainer">'+s.footHtml+"</p></th></tr></tfoot>":"";return a.push("</tbody>"+b+"</table>"),this.jqObj.append(a.join("")),this},getKey:function(e){var t=[];for(var a in e)t.push(a);return t},onChangeHanlder:function(e){var t={},a={},s=this.sourceDataKeys,n=s.length,i=e.parent();t[i.attr("td-class")]=e.html();for(var o=i.siblings(".kalengoTableTd"),r=0,l=o.length;l>r;r++){var d=$(o[r]);t[d.attr("td-class")]=d.find(".contentContainer").html()}for(r=0;n>r;r++)a[s[r]]=t[s[r]];this.options.changeHanlder(a)},destroy:function(){return this.jqObj.unbind().empty(),this},getTableHtml:function(){return this.jqObj.html()}};